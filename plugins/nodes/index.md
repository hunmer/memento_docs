# Nodes - 节点笔记本插件

<PluginSwiper plugin-name="nodes" />

🌳 **Nodes 节点笔记本** - 无限层级的树形节点管理，让思维更有条理

## 核心功能

### 📚 笔记本管理
- **多笔记本支持**：创建多个独立的笔记本，每个笔记本管理独立的节点树
- **自定义图标**：为每个笔记本选择独特的图标标识
- **主题色彩**：自定义笔记本颜色，支持视觉区分
- **拖拽排序**：支持笔记本的拖拽重排序
- **一键清空**：快速清空笔记本中的所有节点

### 🌲 无限层级节点树
- **树形结构**：支持父子节点的树形组织，可无限嵌套层级
- **展开/折叠**：点击节点切换子节点的展开和折叠状态
- **递归渲染**：智能缩进显示节点层级关系
- **路径追踪**：自动计算并显示节点的完整路径

### ✅ 节点状态管理
- **四种状态**：TODO（待办）、DOING（进行中）、DONE（已完成）、NONE（无状态）
- **状态徽章**：直观的颜色编码状态徽章显示
- **快速切换**：长按节点快速切换状态
- **状态统计**：自动统计各状态节点数量

### 🏷️ 丰富的节点属性
- **节点标题**：简洁明了的节点标题
- **标签系统**：为节点添加多个标签，支持标签筛选
- **颜色标识**：13种常用颜色，快速标识节点类型
- **日期范围**：支持设置开始日期和结束日期
- **自定义字段**：添加任意键值对数据，灵活扩展
- **笔记内容**：支持添加详细的节点说明和备注

### 🔄 节点操作
- **添加子节点**：在当前节点下创建子节点
- **添加同级节点**：创建与当前节点同级的节点
- **编辑节点**：修改节点的所有属性
- **删除节点**：递归删除节点及其所有子节点
- **复制导出**：将整个笔记本复制为文本格式

### 🤖 AI 数据集成
- **OpenAI 集成**：注册到 OpenAI 插件，支持 AI 数据分析
- **结构化数据**：自动提取节点树为 JSON 格式
- **智能过滤**：自动移除空字段，优化 AI 处理
- **日期格式化**：标准化的日期格式输出

## 数据模型

### Notebook（笔记本）
```dart
{
  "id": "uuid-1234",           // 唯一标识符
  "title": "工作计划",          // 笔记本标题
  "icon": 57415,              // 图标代码点
  "color": 4280391411,        // 主题颜色
  "nodes": [...]              // 根节点列表
}
```

### Node（节点）
```dart
{
  "id": "uuid-5678",           // 唯一标识符
  "title": "项目A",            // 节点标题
  "createdAt": "2025-01-15T10:30:00.000Z",  // 创建时间
  "tags": ["重要", "紧急"],     // 标签列表
  "status": 1,                // 状态索引：0=todo, 1=doing, 2=done, 3=none
  "startDate": "2025-01-10T09:00:00.000Z",  // 开始日期
  "endDate": "2025-01-20T18:00:00.000Z",    // 结束日期
  "customFields": [            // 自定义字段
    {"key": "优先级", "value": "高"},
    {"key": "负责人", "value": "张三"}
  ],
  "notes": "项目详细说明...",   // 笔记内容
  "parentId": "",             // 父节点ID（空字符串表示根节点）
  "children": [...],          // 子节点列表
  "isExpanded": true,         // 是否展开
  "pathValue": "项目A",        // 节点完整路径
  "color": 4278190080         // 节点颜色标识
}
```

## 使用场景

### 项目管理
- **任务分解**：将大项目拆分为多层级的子任务
- **进度跟踪**：通过状态管理跟踪任务进度
- **时间规划**：设置任务的开始和结束日期
- **责任分工**：通过自定义字段记录负责人信息
- **优先级管理**：使用颜色和标签标识优先级

### 学习笔记
- **知识体系**：构建学科知识的层级结构
- **课程笔记**：按章节组织学习内容
- **复习计划**：通过状态管理跟踪复习进度
- **资料链接**：在自定义字段中存储参考资料

### 生活管理
- **目标规划**：设定长期目标并分解为短期任务
- **购物清单**：组织购物需求的层级分类
- **旅行计划**：规划行程的各个细节
- **习惯追踪**：通过状态管理养成良好习惯

## 界面指南

### 笔记本列表界面
- **拖拽排序**：拖拽手柄调整笔记本顺序
- **左滑删除**：左滑笔记本进入删除确认
- **统计信息**：显示每个笔记本的节点数量
- **快速操作**：更多菜单提供编辑和删除功能

### 节点树界面
- **递归显示**：节点以缩进形式展示层级关系
- **颜色圆点**：节点标题前的颜色标识
- **状态徽章**：TODO/DOING/DONE 状态徽章
- **标签展示**：节点右侧显示标签列表
- **空状态**：无节点时显示引导提示

### 节点编辑界面
- **面包屑导航**：显示从笔记本到当前节点的完整路径
- **标签编辑**：支持添加和删除节点标签
- **颜色选择器**：13种常用颜色快速选择
- **状态选择**：下拉选择节点状态
- **日期选择**：支持设置和清空日期范围
- **自定义字段**：动态添加、编辑、删除字段

## 操作指南

### 创建笔记本
1. 点击笔记本界面的「+」按钮
2. 输入笔记本标题
3. 选择笔记本图标（默认：书本图标）
4. 选择主题颜色（默认：蓝色）
5. 保存创建

### 添加节点
1. 在节点树界面点击「+」按钮添加根节点
2. 或长按现有节点选择「添加子节点」
3. 输入节点标题
4. 选择节点颜色（可选）
5. 设置节点状态（可选）
6. 添加标签（可选）
7. 设置日期范围（可选）
8. 添加自定义字段（可选）
9. 填写笔记内容（可选）
10. 保存节点

### 管理节点状态
1. 长按节点
2. 选择「状态」选项
3. 在弹出的菜单中选择目标状态：
   - 🟡 TODO（待办）- 灰色背景黄色文字
   - 🔵 DOING（进行中）- 蓝色背景深蓝文字
   - 🟢 DONE（已完成）- 绿色背景深绿文字
   - ⚪ NONE（无状态）- 无徽章显示

### 使用标签系统
1. 在节点编辑界面找到「标签」区域
2. 点击「添加标签」按钮
3. 输入标签名称
4. 确认添加
5. 重复添加更多标签
6. 点击标签旁的「×」删除标签

### 设置日期范围
1. 在节点编辑界面找到「日期范围」区域
2. 点击「开始日期」选择开始时间
3. 点击「结束日期」选择结束时间
4. 点击「清空」按钮可清除日期

### 添加自定义字段
1. 在节点编辑界面找到「自定义字段」区域
2. 点击「添加字段」按钮
3. 输入字段名称（键）
4. 输入字段值
5. 确认添加
6. 重复添加更多字段
7. 点击字段旁的「编辑」或「删除」按钮

### 导出节点数据
1. 在节点树界面点击菜单按钮
2. 选择「复制为文本」
3. 系统自动复制缩进格式的文本到剪贴板
4. 粘贴到目标位置查看

示例输出格式：
```
项目A
  项目详细说明...
  子任务1
    子任务1的说明...
  子任务2
项目B
```

## AI 数据分析

### 使用方法
在 OpenAI 插件的对话中，使用以下语法调用：

```
分析我的"工作计划"笔记本中的节点结构:
{{nodes_getNodePaths(notebook_id: "uuid-1234")}}
```

### 返回数据格式
```json
{
  "notebook_title": "工作计划",
  "nodes": [
    {
      "title": "项目A",
      "status": "doing",
      "tags": ["重要"],
      "date_range": {
        "start": "2025/1/10 9:0",
        "end": "2025/1/20 18:0"
      },
      "notes": "项目详细说明...",
      "custom_fields": [
        {"key": "优先级", "value": "高"}
      ],
      "children": [
        {
          "title": "子任务1",
          "status": "done"
        }
      ]
    }
  ]
}
```

### 智能过滤特性
- **自动移除空字段**：null、空字符串、空列表、空Map会被自动移除
- **日期格式化**：统一转换为 `y/m/d h:m` 格式
- **状态字符串化**：将枚举转换为字符串（todo/doing/done/none）
- **递归包含**：自动包含所有层级的子节点数据

## 卡片视图

在主界面卡片中显示三个关键统计：

```
┌─────────────────────────────┐
│ 🌳 节点                    │
├─────────────────────────────┤
│  笔记本数量  │   节点数量   │
│      3      │      42      │
├─────────────────────────────┤
│       待办节点数            │
│           8                 │
└─────────────────────────────┘
```

- **笔记本数量**：当前创建的笔记本总数
- **节点数量**：所有笔记本中节点的总数（递归计算）
- **待办节点数**：状态为 TODO 的节点数量

## 存储结构

所有数据存储在 `nodes/nodes_notebooks` 路径下，以 JSON 格式保存：

```json
{
  "notebooks": [
    {
      "id": "uuid",
      "title": "笔记本标题",
      "icon": 图标代码点,
      "color": 颜色值,
      "nodes": [节点数组]
    }
  ]
}
```

## 最佳实践

### 节点组织
💡 **保持层级清晰**：建议节点层级不超过 5 层，便于管理和查看

💡 **命名规范**：使用简洁明了的节点标题，避免过长

💡 **状态及时更新**：完成任务后及时更新节点状态

💡 **善用标签**：为节点添加有意义的标签，便于分类和检索

### 颜色使用建议
🔴 **红色**：紧急/重要任务
🟠 **橙色**：警告/需要注意
🟡 **黄色**：待定/暂缓
🟢 **绿色**：正常/健康
🔵 **蓝色**：计划/未来
🟣 **紫色**：创意/灵感
⚪ **灰色**：默认/未分类

### 自定义字段场景
- **项目管理**：优先级、负责人、预算、进度
- **学习计划**：难度、时长、资料链接、目标分数
- **生活管理**：地点、联系人、预算、重要性

## 常见问题

**Q: 节点可以有多少层嵌套？**
A: 理论上支持无限层嵌套，但建议不超过 5 层以保证良好的使用体验。

**Q: 如何快速找到某个节点？**
A: 可以通过节点路径（pathValue）快速定位，或通过 AI 分析功能进行搜索。

**Q: 删除节点会同时删除子节点吗？**
A: 是的，删除节点会递归删除其所有子节点，操作前请确认。

**Q: 可以导入外部数据吗？**
A: 目前支持复制为文本导出，暂不支持外部数据导入。

**Q: 节点数据如何备份？**
A: 数据存储在本地，可通过设置中的 WebDAV 同步功能进行备份。

**Q: AI 分析支持哪些操作？**
A: 支持提取节点树结构、状态统计、路径分析等，可用于项目进度分析、任务规划建议等。

**Q: 如何恢复误删的节点？**
A: 目前不支持直接恢复，建议定期备份数据。

**Q: 笔记本数量有限制吗？**
A: 没有硬性限制，但建议根据实际需要创建适量笔记本便于管理。

---

*让思维有结构，让管理更简单 🌳*
