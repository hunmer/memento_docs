# Activity - 活动追踪插件

<PluginSwiper plugin-name="activity" />

🏃 **Activity 活动追踪** - 全方位记录您的日常活动，建立完整的生活轨迹

Activity 插件是 Memento 的核心时间管理模块，提供时间轴视图、网格视图、活动记录管理、标签分组系统、时间统计、统计图表、AI 数据分析集成和时间重叠检测等完整功能。

## 核心功能

### 📊 多视图活动记录

#### 时间轴视图
- **线性展示**：按时间顺序展示所有活动，支持快速浏览和回顾
- **未记录时间段提示**：自动显示未记录的时间段，方便补录
- **滑动操作**：支持滑动删除活动
- **标签筛选**：支持多选标签过滤活动

#### 网格视图
- **24小时网格可视化**：60分钟 × 24小时网格展示
- **拖选时间段**：可拖选连续时间段快速创建活动
- **实时预览**：显示选中时间段的分钟数
- **快速创建**：点击空白时间段即可快速创建活动

### 🏷️ 智能标签系统

#### 标签分组管理
- **分组展示**：将标签按工作、生活、学习等维度分组
- **最近使用**：自动记录最近使用的标签（最多10个）
- **快速选择**：从分组和最近使用列表中快速选择标签
- **批量管理**：支持批量添加、编辑、删除标签组

#### 活动属性
- **标题**：活动名称（必填）
- **时间段**：开始和结束时间（必填）
- **标签**：支持多标签分类（可选）
- **心情**：表情符号记录当时心情（可选）
- **描述**：活动详细描述（可选）
- **颜色**：自定义活动颜色（可选）

### 📈 数据统计与分析

#### 卡片视图（首页）
```
┌─────────────────────────────┐
│ 📅 活动                    │
├─────────────────────────────┤
│  今日活动    │   今日时长   │
│      5      │     6.5H     │
├─────────────────────────────┤
│        剩余时间             │
│         8.3H                │
│  (少于2小时显示红色警告)     │
└─────────────────────────────┘
```

#### 统计图表
1. **时间分布图**（柱状图）
   - X轴：时间段（0-24小时）
   - Y轴：活动时长（分钟）
   - 按小时分组统计活动时长

2. **活动分布饼图**
   - 按标签统计活动时长占比
   - 显示百分比和实际时长

#### 时间范围选项
- 今日
- 本周
- 本月
- 本年
- 自定义范围

### 🤖 AI 数据分析集成

活动插件与 OpenAI 插件深度集成，支持智能数据分析：

#### 返回数据格式
```json
{
  "sum": {
    "total": 10,           // 总活动数
    "tDur": 480,          // 总时长(分钟)
    "avgDur": 48          // 平均时长(分钟)
  },
  "tagStat": {            // 按标签统计时长(分钟)
    "工作": 240,
    "学习": 120,
    "运动": 60
  },
  "records": [            // 详细活动记录列表
    {
      "start": "2025-01-15 08:00",
      "end": "10:00",
      "dur": 120,
      "title": "晨间会议",
      "tags": ["工作", "会议"],
      "desc": "讨论项目进度",
      "mood": "😊"
    }
  ]
}
```

## 使用场景

### 个人成长追踪
记录学习、工作、锻炼等各类活动，帮助您：
- 了解时间分配是否合理
- 追踪目标完成进度
- 发现高效时间段
- 培养良好习惯

### 生活记录与回顾
将日常活动数字化保存：
- 旅行足迹记录
- 兴趣爱好发展轨迹
- 人际交往活动
- 创意灵感收集

### 数据驱动决策
基于活动数据做出生活调整：
- 分析哪些活动让您更有活力
- 优化日程安排
- 平衡工作与生活
- 制定更合理的目标

## 操作指南

### 添加活动
1. 点击右下角「+」按钮或点击网格视图空白时间段
2. 输入活动标题
3. 选择开始和结束时间
4. 从标签分组或最近使用中选择标签（可选）
5. 选择心情表情（可选）
6. 添加详细描述（可选）
7. 选择活动颜色（可选）
8. 保存记录

### 网格视图快速创建
1. 切换到网格视图模式
2. 拖选连续时间段
3. 在弹出的表单中填写活动信息
4. 保存

### 管理标签
1. 点击时间轴界面的标签筛选按钮
2. 选择"管理标签"
3. 添加/编辑/删除标签组
4. 标签组数据自动保存到本地

### 查看统计
1. 点击底部导航栏「统计」选项
2. 选择统计周期（今日/本周/本月/本年/自定义）
3. 查看时间分布图和活动分布饼图
4. 分析活动数据

## 高级功能

### 时间重叠检测
- **自动检测**：创建或编辑活动时自动检测时间重叠
- **智能处理**：新活动与现有活动重叠时，自动替换原活动
- **编辑保护**：允许编辑自身活动，但不允许与其他活动重叠
- **即时验证**：实时验证时间段是否有效

### 跨日期活动支持
- **自动迁移**：活动跨日期时自动迁移到新日期文件
- **数据完整性**：确保跨日期活动数据不丢失
- **智能更新**：编辑跨日期活动时自动处理文件迁移

### 数据存储结构
活动数据按日期分文件存储：
```
activity/
├── tag_groups.json                # 标签分组配置
├── recent_tags.json               # 最近使用的标签(最多10个)
├── recent_moods.json              # 最近使用的心情(最多10个)
├── activities_2025-01-15.json    # 2025年1月15日的活动记录
├── activities_2025-01-16.json    # 2025年1月16日的活动记录
└── ...
```

### 国际化支持
- 简体中文 (zh)
- 英语 (en)
- 所有界面文本和提示信息均支持双语

## API 接口

### 统计接口
```dart
// 获取今日活动数
Future<int> getTodayActivityCount();

// 获取今日活动总时长(分钟)
Future<int> getTodayActivityDuration();

// 获取今日剩余时间(分钟)
int getTodayRemainingTime();
```

### 活动管理接口
```dart
// 保存活动记录(自动处理时间重叠)
Future<void> saveActivity(ActivityRecord activity);

// 获取指定日期的所有活动
Future<List<ActivityRecord>> getActivitiesForDate(DateTime date);

// 更新活动记录(支持跨日期更新)
Future<void> updateActivity(ActivityRecord oldActivity, ActivityRecord newActivity);

// 删除活动记录
Future<void> deleteActivity(ActivityRecord activity);

// 检查时间段是否有重叠的活动
Future<bool> hasOverlappingActivities(DateTime start, DateTime end, {ActivityRecord? excludeActivity});
```

### 标签管理接口
```dart
// 标签分组管理
Future<void> saveTagGroups(List<TagGroup> groups);
Future<List<TagGroup>> getTagGroups();

// 最近使用标签管理
Future<void> saveRecentTags(List<String> tags);
Future<List<String>> getRecentTags();

// 最近使用心情管理
Future<void> saveRecentMoods(List<String> moods);
Future<List<String>> getRecentMoods();
```

## 小贴士

💡 **定期回顾**：建议每周花几分钟回顾本周活动，发现生活中的亮点和需要改进的地方

💡 **标签命名**：使用一致性的标签命名规则，如「工作-项目A」、「运动-跑步」等，便于后续统计

💡 **及时记录**：趁记忆清晰时记录活动详情，可以添加详细描述和心情

💡 **数据可视化**：通过图表发现自己的活动规律，调整生活节奏

💡 **网格视图**：需要快速记录活动时，使用网格视图拖选时间段更高效

💡 **AI 分析**：结合 OpenAI 插件进行深度数据分析，获得个性化建议

## 常见问题

**Q: 如何处理时间重叠的活动？**
A: Activity 插件会自动检测时间重叠。新活动与现有活动重叠时会自动替换原活动。编辑时允许编辑自身，但不允许与其他活动重叠。

**Q: 如何在 AI 分析中使用活动数据？**
A: 在 OpenAI 插件的系统提示词或用户消息中使用 `` {{`activity_getActivitys(startDate: "2025-01-01", endDate: "2025-01-31")`}} ``，OpenAI 插件会自动调用活动数据并替换占位符。

**Q: 网格视图和时间轴视图有什么区别？**
A: 时间轴视图适合查看和浏览，线性展示所有活动；网格视图适合快速创建活动，24小时×60分钟网格可视化，可拖选时间段。

**Q: 活动数据存储在哪里？**
A: 活动数据按日期分文件存储在 `activity/activities_<YYYY-MM-DD>.json` 中。标签分组、最近使用标签等信息分别存储在对应的 JSON 文件中。

**Q: 如何自定义标签分组？**
A: 点击时间轴界面的标签筛选按钮 → 选择"管理标签" → 添加/编辑/删除标签组。标签组数据存储在 `activity/tag_groups.json` 中。

**Q: 活动支持跨日期吗？**
A: 支持。活动按开始时间的日期分文件存储，跨日期活动会自动迁移到新日期文件。

---

*让每一次活动都成为成长的足迹*
