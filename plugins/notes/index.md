# Notes - æ— é™å±‚çº§ç¬”è®°æ’ä»¶

<PluginSwiper plugin-name="notes" />

ğŸ“ **Notes æ— é™å±‚çº§ç¬”è®°** - æ„å»ºæ‚¨çš„ä¸ªäººçŸ¥è¯†åº“

## æ’ä»¶æ¦‚è¿°

Notes æ’ä»¶æ˜¯ Memento çš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ä¹‹ä¸€ï¼Œæä¾›å®Œæ•´çš„ç¬”è®°ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸŒ³ **æ— é™å±‚çº§æ–‡ä»¶å¤¹**ï¼šæ”¯æŒä»»æ„æ·±åº¦çš„æ–‡ä»¶å¤¹æ ‘å½¢ç»“æ„
- âœï¸ **Markdown ç¬”è®°ç¼–è¾‘**ï¼šæ”¯æŒå¯Œæ–‡æœ¬æ ¼å¼çš„ç¬”è®°å†…å®¹
- ğŸ·ï¸ **æ ‡ç­¾ç³»ç»Ÿ**ï¼šä¸ºç¬”è®°æ·»åŠ å¤šä¸ªæ ‡ç­¾ä»¥ä¾¿åˆ†ç±»
- ğŸ” **å…¨æ–‡æœç´¢**ï¼šæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€æ ‡ç­¾ã€æ—¥æœŸèŒƒå›´çš„å¤åˆæœç´¢
- ğŸ“ **ç¬”è®°ç§»åŠ¨**ï¼šåœ¨æ–‡ä»¶å¤¹ä¹‹é—´è‡ªç”±ç§»åŠ¨ç¬”è®°
- ğŸ¤– **AI æ•°æ®åˆ†æ**ï¼šæ³¨å†Œåˆ° OpenAI æ’ä»¶ï¼Œæ”¯æŒç¬”è®°æ•°æ®æå–
- ğŸ“¡ **äº‹ä»¶ç³»ç»Ÿ**ï¼šå¹¿æ’­ç¬”è®°çš„åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤äº‹ä»¶

## ä½¿ç”¨åœºæ™¯

### å­¦ä¹ ç¬”è®°
- **è¯¾ç¨‹ç¬”è®°**ï¼šæŒ‰å­¦ç§‘ã€ç« èŠ‚ç»„ç»‡å­¦ä¹ å†…å®¹
- **è¯»ä¹¦ç¬”è®°**ï¼šè®°å½•è¯»ä¹¦å¿ƒå¾—å’Œé‡ç‚¹æ‘˜è¦
- **è®ºæ–‡ç ”ç©¶**ï¼šç®¡ç†å­¦æœ¯è®ºæ–‡å’Œç ”ç©¶èµ„æ–™
- **çŸ¥è¯†ä½“ç³»**ï¼šæ„å»ºå®Œæ•´çš„å­¦ç§‘çŸ¥è¯†æ¡†æ¶

### å·¥ä½œæ–‡æ¡£
- **é¡¹ç›®æ–‡æ¡£**ï¼šç®¡ç†é¡¹ç›®æ–‡æ¡£å’Œèµ„æ–™
- **ä¼šè®®è®°å½•**ï¼šè®°å½•ä¼šè®®å†…å®¹å’Œå¾…åŠäº‹é¡¹
- **æ ‡å‡†æµç¨‹**ï¼šå»ºç«‹æ ‡å‡†æ“ä½œæµç¨‹æ–‡æ¡£
- **å›¢é˜Ÿåä½œ**ï¼šå›¢é˜Ÿå…±äº«çŸ¥è¯†å’Œç»éªŒ

### ä¸ªäººçŸ¥è¯†åº“
- **çµæ„Ÿæ”¶é›†**ï¼šéšæ—¶è®°å½•çªå‘çµæ„Ÿ
- **ç»éªŒæ€»ç»“**ï¼šæ€»ç»“å·¥ä½œå’Œç”Ÿæ´»ç»éªŒ
- **æ”»ç•¥æŒ‡å—**ï¼šåˆ¶ä½œå„ç§å®ç”¨æ”»ç•¥
- **æ”¶è—æ•´ç†**ï¼šæ•´ç†ç½‘ç»œä¼˜è´¨å†…å®¹

### åˆ›ä½œç®¡ç†
- **æ–‡ç« è‰ç¨¿**ï¼šç®¡ç†æ–‡ç« å’Œåˆ›ä½œè‰ç¨¿
- **ç´ æåº“**ï¼šæ”¶é›†å†™ä½œç´ æå’Œå‚è€ƒèµ„æ–™
- **åˆ›ä½œå¤§çº²**ï¼šè§„åˆ’é•¿ç¯‡åˆ›ä½œç»“æ„
- **çµæ„Ÿç°¿**ï¼šè®°å½•åˆ›ä½œçµæ„Ÿ

## æ“ä½œæŒ‡å—

### åˆ›å»ºç¬”è®°
1. ç‚¹å‡»ã€Œ+ã€æŒ‰é’®åˆ›å»ºæ–°ç¬”è®°
2. è¾“å…¥ç¬”è®°æ ‡é¢˜å’Œå†…å®¹ï¼ˆæ”¯æŒ Markdownï¼‰
3. é€‰æ‹©æ‰€å±æ–‡ä»¶å¤¹
4. æ·»åŠ æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰
5. ä¿å­˜ç¬”è®°

### ç®¡ç†å±‚çº§
1. ç‚¹å‡»æ–‡ä»¶å¤¹è¿›å…¥ä¸‹çº§ç›®å½•
2. é•¿æŒ‰ç¬”è®°æ˜¾ç¤ºæ“ä½œèœå•
3. é€‰æ‹©ç¼–è¾‘/ç§»åŠ¨/åˆ é™¤æ“ä½œ
4. ä½¿ç”¨è¿”å›æŒ‰é’®å¯¼èˆªä¸Šçº§ç›®å½•

### æœç´¢ç¬”è®°
1. ç‚¹å‡»æœç´¢æŒ‰é’®
2. è¾“å…¥å…³é”®è¯æœç´¢
3. å¯é€‰æ‹©æ ‡ç­¾å’Œæ—¥æœŸèŒƒå›´è¿›è¡Œç­›é€‰
4. æŸ¥çœ‹æœç´¢ç»“æœåˆ—è¡¨

## API æ–‡æ¡£

### æ ¸å¿ƒæ§åˆ¶å™¨æ–¹æ³•

#### æ–‡ä»¶å¤¹ç®¡ç†

```dart
// è·å–æ–‡ä»¶å¤¹
Folder? getFolder(String id)

// è·å–æ‰€æœ‰æ–‡ä»¶å¤¹
List<Folder> getAllFolders()

// è·å–æŒ‡å®šæ–‡ä»¶å¤¹çš„å­æ–‡ä»¶å¤¹
List<Folder> getFolderChildren(String parentId)

// åˆ›å»ºæ–°æ–‡ä»¶å¤¹
Future<Folder> createFolder(String name, String? parentId)

// é‡å‘½åæ–‡ä»¶å¤¹
Future<void> renameFolder(String folderId, String newName)

// åˆ é™¤æ–‡ä»¶å¤¹(é€’å½’åˆ é™¤å­æ–‡ä»¶å¤¹å’Œç¬”è®°)
Future<void> deleteFolder(String folderId)
```

#### ç¬”è®°ç®¡ç†

```dart
// è·å–æ–‡ä»¶å¤¹ä¸­çš„ç¬”è®°
List<Note> getFolderNotes(String folderId)

// åˆ›å»ºæ–°ç¬”è®°
Future<Note> createNote(String title, String content, String folderId)

// æ›´æ–°ç¬”è®°
Future<void> updateNote(Note note)

// åˆ é™¤ç¬”è®°
Future<void> deleteNote(String noteId)
Future<void> deleteNoteObject(Note note)

// ç§»åŠ¨ç¬”è®°åˆ°å…¶ä»–æ–‡ä»¶å¤¹
Future<void> moveNote(String noteId, String targetFolderId)
```

#### æœç´¢åŠŸèƒ½

```dart
// æœç´¢ç¬”è®°(æ”¯æŒæ ‡é¢˜/å†…å®¹/æ ‡ç­¾/æ—¥æœŸèŒƒå›´)
List<Note> searchNotes({
  required String query,
  List<String>? tags,
  DateTime? startDate,
  DateTime? endDate,
})
```

#### ç»Ÿè®¡æ¥å£

```dart
// è·å–æ€»ç¬”è®°æ•°
int getTotalNotesCount()

// è·å–æœ€è¿‘7å¤©çš„ç¬”è®°æ•°
int getRecentNotesCount()
```

### AI é›†æˆæ¥å£

#### æ•°æ®æå–æ–¹æ³•

```dart
// è·å–æŒ‡å®šæ–‡ä»¶å¤¹æˆ–ç¬”è®°IDçš„ç¬”è®°æ•°æ®(ä¾› OpenAI æ’ä»¶è°ƒç”¨)
Future<String> getNotes(Map<String, dynamic> params)
// params: {
//   "folder_ids": ["folder1", "folder2"],  // å¯é€‰
//   "note_ids": ["note1", "note2"]         // å¯é€‰
// }
// è¿”å›: JSON å­—ç¬¦ä¸²,åŒ…å«ç¬”è®°åˆ—è¡¨
// ç¤ºä¾‹: {"notes": [{"id": "...", "title": "...", "content": "...", "folder_name": "..."}]}
```

**è°ƒç”¨ç¤ºä¾‹**ï¼š

åœ¨ OpenAI æ’ä»¶çš„ Prompt ä¸­ä½¿ç”¨ï¼š
```
åˆ†ææˆ‘åœ¨"å·¥ä½œç¬”è®°"æ–‡ä»¶å¤¹ä¸­çš„ç¬”è®°å†…å®¹:
{{notes_getNotes(folder_ids: ["1234567890"])}}
```

æˆ–æŒ‡å®šç¬”è®°IDï¼š
```
æ€»ç»“è¿™äº›ç¬”è®°çš„è¦ç‚¹:
{{notes_getNotes(note_ids: ["123", "456", "789"])}}
```

## æ•°æ®æ¨¡å‹

### Folder (æ–‡ä»¶å¤¹)

```dart
class Folder {
  String id;               // å”¯ä¸€æ ‡è¯†ç¬¦(æ—¶é—´æˆ³å­—ç¬¦ä¸²)
  String name;             // æ–‡ä»¶å¤¹åç§°
  String? parentId;        // çˆ¶æ–‡ä»¶å¤¹ID(null è¡¨ç¤ºæ ¹æ–‡ä»¶å¤¹)
  DateTime createdAt;      // åˆ›å»ºæ—¶é—´
  DateTime updatedAt;      // æ›´æ–°æ—¶é—´
  Color color;             // æ–‡ä»¶å¤¹é¢œè‰²(é»˜è®¤è“è‰²)
  IconData icon;           // æ–‡ä»¶å¤¹å›¾æ ‡(é»˜è®¤ folder å›¾æ ‡)
}
```

**å±‚çº§ç»“æ„å®ç°**ï¼š
- ä½¿ç”¨ `parentId` å­—æ®µå»ºç«‹çˆ¶å­å…³ç³»
- `parentId = null` è¡¨ç¤ºæ ¹æ–‡ä»¶å¤¹
- é€šè¿‡ `getFolderChildren(parentId)` è·å–å­æ–‡ä»¶å¤¹
- æ”¯æŒæ— é™å±‚çº§åµŒå¥—

### Note (ç¬”è®°)

```dart
class Note {
  String id;               // å”¯ä¸€æ ‡è¯†ç¬¦(æ—¶é—´æˆ³å­—ç¬¦ä¸²)
  String title;            // ç¬”è®°æ ‡é¢˜
  String content;          // ç¬”è®°å†…å®¹(Markdown æ ¼å¼)
  String folderId;         // æ‰€å±æ–‡ä»¶å¤¹ID
  DateTime createdAt;      // åˆ›å»ºæ—¶é—´
  DateTime updatedAt;      // æ›´æ–°æ—¶é—´
  List<String> tags;       // æ ‡ç­¾åˆ—è¡¨
}
```

## æ•°æ®å­˜å‚¨

### å­˜å‚¨è·¯å¾„

**æ ¹ç›®å½•**: `notes/`

### å­˜å‚¨ç»“æ„

```
notes/
â”œâ”€â”€ folders.json              # æ‰€æœ‰æ–‡ä»¶å¤¹æ•°æ®
â””â”€â”€ notes.json                # æ‰€æœ‰ç¬”è®°æ•°æ®
```

### æ•°æ®æ ¼å¼

**folders.json**:
```json
[
  {
    "id": "root",
    "name": "Root",
    "parentId": null,
    "createdAt": "2025-01-15T10:30:00.000Z",
    "updatedAt": "2025-01-15T10:30:00.000Z",
    "color": 4280391411,
    "icon": 57415
  }
]
```

**notes.json**:
```json
[
  {
    "id": "1234567890123",
    "title": "é¡¹ç›®è®¡åˆ’",
    "content": "# é¡¹ç›®è®¡åˆ’\n\næœ¬å‘¨ç›®æ ‡:\n- å®Œæˆè®¾è®¡ç¨¿\n- å¼€å‘æ ¸å¿ƒåŠŸèƒ½",
    "folderId": "1234567890",
    "createdAt": "2025-01-15T08:30:00.000Z",
    "updatedAt": "2025-01-15T20:15:00.000Z",
    "tags": ["å·¥ä½œ", "è®¡åˆ’"]
  }
]
```

## äº‹ä»¶ç³»ç»Ÿ

### äº‹ä»¶ç±»å‹

| äº‹ä»¶å | äº‹ä»¶ç±» | è§¦å‘æ—¶æœº | å‚æ•° |
|-------|--------|---------|------|
| `note_added` | `ItemEventArgs` | åˆ›å»ºç¬”è®°æ—¶ | `itemId`, `title`, `action` |
| `note_deleted` | `ItemEventArgs` | åˆ é™¤ç¬”è®°æ—¶ | `itemId`, `title`, `action` |

### äº‹ä»¶å¹¿æ’­ç¤ºä¾‹

```dart
// åˆ›å»ºç¬”è®°æ—¶
await _saveNotes();
_notifyEvent('added', note);

// åˆ é™¤ç¬”è®°æ—¶
notes.removeAt(noteIndex);
_notifyEvent('deleted', note);
await _saveNotes();
```

## å¡ç‰‡è§†å›¾

æ’ä»¶åœ¨ä¸»é¡µæä¾›å¡ç‰‡è§†å›¾ï¼Œå±•ç¤º:

**å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ ç¬”è®°                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ€»ç¬”è®°æ•°    â”‚   æœ€è¿‘ç¬”è®°   â”‚
â”‚     128     â”‚      15      â”‚
â”‚             â”‚   (7å¤©å†…)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç›®å½•ç»“æ„

```
notes/
â”œâ”€â”€ notes_plugin.dart                    # æ’ä»¶ä¸»ç±»
â”œâ”€â”€ notes_plugin_entry.dart              # æ’ä»¶å…¥å£ç‚¹
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ folder.dart                      # æ–‡ä»¶å¤¹æ¨¡å‹
â”‚   â””â”€â”€ note.dart                        # ç¬”è®°æ¨¡å‹
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ notes_controller.dart            # æ ¸å¿ƒæ§åˆ¶å™¨(CRUD + æœç´¢)
â”œâ”€â”€ services/
â”‚   â””â”€â”€ prompt_replacements.dart         # AI Prompt æ›¿æ¢æ–¹æ³•
â”œâ”€â”€ controls/
â”‚   â””â”€â”€ prompt_controller.dart           # Prompt æ§åˆ¶å™¨(æ³¨å†Œåˆ° OpenAI)
â”œâ”€â”€ screens/
â”‚   â”œâ”€â”€ notes_screen.dart                # ä¸»ç•Œé¢
â”‚   â”œâ”€â”€ note_edit_screen.dart            # ç¼–è¾‘ç•Œé¢
â”‚   â”œâ”€â”€ search_screen.dart               # æœç´¢ç•Œé¢
â”‚   â”œâ”€â”€ folder_list_screen.dart          # æ–‡ä»¶å¤¹åˆ—è¡¨ç•Œé¢
â”‚   â”œâ”€â”€ notes_screen/                    # ä¸»ç•Œé¢æ¨¡å—åŒ–ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ notes_screen_state.dart      # çŠ¶æ€åŸºç±»
â”‚   â”‚   â”œâ”€â”€ folder_operations.dart       # æ–‡ä»¶å¤¹æ“ä½œ Mixin
â”‚   â”‚   â”œâ”€â”€ note_operations.dart         # ç¬”è®°æ“ä½œ Mixin
â”‚   â”‚   â”œâ”€â”€ folder_item.dart             # æ–‡ä»¶å¤¹é¡¹ Mixin
â”‚   â”‚   â”œâ”€â”€ note_item.dart               # ç¬”è®°é¡¹ Mixin
â”‚   â”‚   â””â”€â”€ folder_selection_dialog.dart # æ–‡ä»¶å¤¹é€‰æ‹©å¯¹è¯æ¡† Mixin
â”‚   â””â”€â”€ note_screen/                     # ç¬”è®°ç•Œé¢ç»„ä»¶(å¤‡ç”¨)
â”‚       â”œâ”€â”€ index.dart
â”‚       â”œâ”€â”€ notes_screen.dart
â”‚       â”œâ”€â”€ notes_list_view.dart
â”‚       â”œâ”€â”€ notes_app_bar.dart
â”‚       â”œâ”€â”€ folder_list_tile.dart
â”‚       â”œâ”€â”€ note_list_tile.dart
â”‚       â”œâ”€â”€ folder_selection_dialog.dart
â”‚       â”œâ”€â”€ folder_operations.dart
â”‚       â””â”€â”€ note_operations.dart
â”œâ”€â”€ widgets/
â”‚   â”œâ”€â”€ folder_item.dart                 # æ–‡ä»¶å¤¹åˆ—è¡¨é¡¹ç»„ä»¶
â”‚   â”œâ”€â”€ note_item.dart                   # ç¬”è®°åˆ—è¡¨é¡¹ç»„ä»¶
â”‚   â”œâ”€â”€ search_note_item.dart            # æœç´¢ç»“æœé¡¹ç»„ä»¶
â”‚   â””â”€â”€ tag_input.dart                   # æ ‡ç­¾è¾“å…¥ç»„ä»¶
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ text_highlight.dart              # æ–‡æœ¬é«˜äº®å·¥å…·
â””â”€â”€ l10n/
    â”œâ”€â”€ notes_localizations.dart         # å›½é™…åŒ–æ¥å£
    â”œâ”€â”€ notes_localizations_zh.dart      # ä¸­æ–‡ç¿»è¯‘
    â””â”€â”€ notes_localizations_en.dart      # è‹±æ–‡ç¿»è¯‘
```

## å›½é™…åŒ–

### æ”¯æŒè¯­è¨€

- ç®€ä½“ä¸­æ–‡ (zh)
- è‹±è¯­ (en)

### æœ¬åœ°åŒ–æ–‡ä»¶

| æ–‡ä»¶ | è¯­è¨€ |
|------|------|
| `l10n/notes_localizations.dart` | æœ¬åœ°åŒ–æ¥å£ |
| `l10n/notes_localizations_zh.dart` | ä¸­æ–‡ç¿»è¯‘ |
| `l10n/notes_localizations_en.dart` | è‹±æ–‡ç¿»è¯‘ |

### å…³é”®å­—ç¬¦ä¸²

```dart
abstract class NotesLocalizations {
  String get name;                  // æ’ä»¶åç§°
  String get totalNotes;            // æ€»ç¬”è®°æ•°
  String get recentNotes;           // æœ€è¿‘ç¬”è®°
  String get newNote;               // æ–°å»ºç¬”è®°
  String get newFolder;             // æ–°å»ºæ–‡ä»¶å¤¹
  String get editNote;              // ç¼–è¾‘
  String get moveNote;              // ç§»åŠ¨åˆ°
  String get deleteNote;            // åˆ é™¤
  String get deleteNoteConfirm;     // åˆ é™¤ç¡®è®¤
  String get renameFolder;          // é‡å‘½åæ–‡ä»¶å¤¹
  String get deleteFolder;          // åˆ é™¤æ–‡ä»¶å¤¹
  String get deleteFolderConfirm;   // åˆ é™¤æ–‡ä»¶å¤¹ç¡®è®¤
  String get search;                // æœç´¢
  String get emptyFolder;           // ç©ºæ–‡ä»¶å¤¹æç¤º
  String get folders;               // æ–‡ä»¶å¤¹
  String get notes;                 // ç¬”è®°
  String get tags;                  // æ ‡ç­¾
  String get dateRange;             // æ—¥æœŸèŒƒå›´
}
```

## å…³é”®å®ç°ç»†èŠ‚

### 1. æ— é™å±‚çº§æ–‡ä»¶å¤¹å®ç°

**æ ¸å¿ƒæ•°æ®ç»“æ„**:
```dart
class Folder {
  String id;
  String? parentId;  // æŒ‡å‘çˆ¶æ–‡ä»¶å¤¹
}

// å†…å­˜å­˜å‚¨: Map<String, Folder>
Map<String, Folder> _folders = {};
```

**æ ‘å½¢éå†**:
```dart
// è·å–å­æ–‡ä»¶å¤¹
List<Folder> getFolderChildren(String parentId) {
  return _folders.values
      .where((folder) => folder.parentId == parentId)
      .toList();
}

// é€’å½’åˆ é™¤
Future<void> deleteFolder(String folderId) async {
  final children = getFolderChildren(folderId);
  for (var child in children) {
    await deleteFolder(child.id);  // æ·±åº¦ä¼˜å…ˆåˆ é™¤
  }
  _folders.remove(folderId);
  _notes.remove(folderId);
}
```

**å¯¼èˆªå†å²**:
```dart
// åœ¨ NotesMainViewState ä¸­
List<String> _folderHistory = ['root'];

void navigateToFolder(Folder folder) {
  _folderHistory.add(folder.id);
  loadCurrentFolder();
}

void navigateBack() {
  if (_folderHistory.length > 1) {
    _folderHistory.removeLast();
    loadCurrentFolder();
  }
}
```

### 2. æ•°æ®æŒä¹…åŒ–æœºåˆ¶

**å•æ–‡ä»¶å­˜å‚¨**:
- `folders.json`: æ‰€æœ‰æ–‡ä»¶å¤¹æ•°æ®çš„ JSON æ•°ç»„
- `notes.json`: æ‰€æœ‰ç¬”è®°æ•°æ®çš„ JSON æ•°ç»„

**ä¼˜ç‚¹**:
- ç®€å•æ˜“ç»´æŠ¤
- ä¸€æ¬¡è¯»å–æ‰€æœ‰æ•°æ®,å†…å­˜æ“ä½œå¿«é€Ÿ
- é€‚åˆä¸­å°è§„æ¨¡æ•°æ®(<1000æ¡)

**ç¼ºç‚¹**:
- æ¯æ¬¡ä¿å­˜éœ€è¦åºåˆ—åŒ–å…¨éƒ¨æ•°æ®
- å¤§æ•°æ®é‡ä¸‹æ€§èƒ½ä¸‹é™

### 3. Mixin æ¶æ„è®¾è®¡

å°†ç•Œé¢é€»è¾‘æ‹†åˆ†ä¸ºå¤šä¸ª Mixin,ç»„åˆä½¿ç”¨:

```dart
// åŸºç±» - æä¾›çŠ¶æ€å­—æ®µ
abstract class NotesMainViewState extends State<NotesMainView> {
  late NotesController controller;
  Folder? currentFolder;
  List<Folder> subFolders = [];
  List<Note> notes = [];
  bool isSearching = false;
  TextEditingController searchController = TextEditingController();
}

// Mixin - æ–‡ä»¶å¤¹æ“ä½œ
mixin FolderOperations on NotesMainViewState {
  Future<void> createNewFolder() async { /* ... */ }
  Future<void> renameFolder(Folder folder) async { /* ... */ }
  Future<void> deleteFolder(Folder folder) async { /* ... */ }
}

// Mixin - ç¬”è®°æ“ä½œ
mixin NoteOperations on NotesMainViewState {
  void createNewNote() { /* ... */ }
  void editNote(Note note) { /* ... */ }
  Future<void> moveNote(Note note) async { /* ... */ }
  Future<void> deleteNote(Note note) async { /* ... */ }
}

// æœ€ç»ˆç»„åˆ
class _NotesMainViewState extends NotesMainViewState
    with FolderOperations, NoteOperations, FolderItem, NoteItem {
  // æ‹¥æœ‰æ‰€æœ‰ Mixin çš„æ–¹æ³•
}
```

**ä¼˜ç‚¹**:
- èŒè´£åˆ†ç¦»,ä»£ç æ¸…æ™°
- æ˜“äºå•ç‹¬æµ‹è¯•æ¯ä¸ª Mixin
- é¿å…å•æ–‡ä»¶è¿‡é•¿(>1000è¡Œ)

### 4. æœç´¢å¤åˆæ¡ä»¶å®ç°

```dart
List<Note> searchNotes({
  required String query,
  List<String>? tags,
  DateTime? startDate,
  DateTime? endDate,
}) {
  final allNotes = _notes.values.expand((notes) => notes).toList();
  return allNotes.where((note) {
    // æ¡ä»¶1: æ ‡é¢˜æˆ–å†…å®¹åŒ¹é…
    if (!note.title.toLowerCase().contains(query.toLowerCase()) &&
        !note.content.toLowerCase().contains(query.toLowerCase())) {
      return false;
    }

    // æ¡ä»¶2: æ ‡ç­¾åŒ¹é…(ä»»ä¸€æ ‡ç­¾åŒ¹é…å³å¯)
    if (tags != null && tags.isNotEmpty) {
      if (!tags.any((tag) => note.tags.contains(tag))) {
        return false;
      }
    }

    // æ¡ä»¶3: æ—¥æœŸèŒƒå›´åŒ¹é…
    if (startDate != null && note.createdAt.isBefore(startDate)) {
      return false;
    }
    if (endDate != null) {
      final endOfDay = DateTime(
        endDate.year,
        endDate.month,
        endDate.day,
        23, 59, 59,
      );
      if (note.createdAt.isAfter(endOfDay)) {
        return false;
      }
    }

    return true;
  }).toList();
}
```

## ä¾èµ–å…³ç³»

### æ ¸å¿ƒä¾èµ–

- **BasePlugin**: æ’ä»¶åŸºç±»
- **StorageManager**: æ•°æ®æŒä¹…åŒ–
- **EventManager**: äº‹ä»¶å¹¿æ’­ç³»ç»Ÿ
- **PluginManager**: æ’ä»¶ç®¡ç†å™¨

### ç¬¬ä¸‰æ–¹åŒ…ä¾èµ–

æ— å¤–éƒ¨ç¬¬ä¸‰æ–¹åŒ…ä¾èµ–(ä»…ä½¿ç”¨ Flutter SDK)

### å…¶ä»–æ’ä»¶ä¾èµ–

- **OpenAI Plugin**: å¯é€‰ä¾èµ–,ç”¨äº AI æ•°æ®åˆ†æ

**ä¾èµ–æ–¹å‘**: `notes` â†’ `openai`(é€šè¿‡ `PluginManager` è·å–)

## å¸¸è§é—®é¢˜

**Q: å¦‚ä½•å®ç°æ— é™å±‚çº§æ–‡ä»¶å¤¹?**
A: ä½¿ç”¨ `parentId` å­—æ®µå»ºç«‹æ ‘å½¢ç»“æ„,`parentId = null` è¡¨ç¤ºæ ¹æ–‡ä»¶å¤¹,é€šè¿‡ `getFolderChildren(parentId)` è·å–å­æ–‡ä»¶å¤¹,æ”¯æŒæ— é™å±‚çº§åµŒå¥—ã€‚

**Q: å¦‚ä½•æ·»åŠ æ–°çš„æœç´¢æ¡ä»¶?**
A: åœ¨ `searchNotes()` æ–¹æ³•ä¸­æ·»åŠ è¿‡æ»¤é€»è¾‘,å¯ä»¥æ·»åŠ æ–‡ä»¶å¤¹è¿‡æ»¤ã€æ ‡ç­¾è¿‡æ»¤ç­‰æ¡ä»¶ã€‚

**Q: å¦‚ä½•åœ¨ AI åˆ†æä¸­ä½¿ç”¨ç¬”è®°æ•°æ®?**
A: åœ¨ OpenAI æ’ä»¶çš„ç³»ç»Ÿæç¤ºè¯æˆ–ç”¨æˆ·æ¶ˆæ¯ä¸­ä½¿ç”¨ `` {{`notes_getNotes(folder_ids: ["1234567890"])`}} `` æ ¼å¼è°ƒç”¨ã€‚

**Q: ç¬”è®°å†…å®¹æ”¯æŒå“ªäº›æ ¼å¼?**
A: å½“å‰æ”¯æŒ Markdown æ ¼å¼,å­˜å‚¨åœ¨ `content` å­—æ®µã€‚

**Q: æ–‡ä»¶å¤¹å’Œç¬”è®°çš„IDæ˜¯å¦‚ä½•ç”Ÿæˆçš„?**
A: ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºå”¯ä¸€æ ‡è¯†ç¬¦,ç®€å•ã€é€’å¢ã€æ— éœ€é¢å¤–ä¾èµ–ã€‚

---

## å°è´´å£«

ğŸ’¡ **å¿«æ·é”®ä½¿ç”¨**ï¼šç†Ÿç»ƒä½¿ç”¨å¿«æ·é”®æé«˜ç¼–è¾‘æ•ˆç‡

ğŸ’¡ **å¤§çº²è§†å›¾**ï¼šä½¿ç”¨å¤§çº²è§†å›¾å¿«é€Ÿæµè§ˆç»“æ„

ğŸ’¡ **å…¨å±ç¼–è¾‘**ï¼šå…¨å±æ¨¡å¼ä¸‹ä¸“æ³¨å†™ä½œ

ğŸ’¡ **è‡ªåŠ¨ä¿å­˜**ï¼šå¼€å¯è‡ªåŠ¨ä¿å­˜é¿å…æ•°æ®ä¸¢å¤±

ğŸ’¡ **å¤šç«¯åŒæ­¥**ï¼šå¼€å¯äº‘åŒæ­¥å¤šè®¾å¤‡è®¿é—®

ğŸ’¡ **å±‚çº§å‘½åè§„èŒƒ**ï¼šå»ºç«‹ç»Ÿä¸€çš„æ–‡ä»¶å¤¹å‘½åè§„èŒƒ

ğŸ’¡ **å®šæœŸæ•´ç†**ï¼šå®šæœŸæ•´ç†ç¬”è®°ï¼Œåˆ é™¤æ— ç”¨å†…å®¹

ğŸ’¡ **äº¤å‰é“¾æ¥**ï¼šä½¿ç”¨é“¾æ¥åœ¨ç›¸å…³ç¬”è®°é—´è·³è½¬

ğŸ’¡ **æ¨¡æ¿å¤ç”¨**ï¼šåˆ›å»ºå¸¸ç”¨æ¨¡æ¿æé«˜æ•ˆç‡

---

*è®©çŸ¥è¯†æœ‰åºç”Ÿé•¿ï¼Œè®©æ€è€ƒè§¦æ‰‹å¯åŠ*
