# Calendar - 日历插件

![Calendar Plugin](/icon.png)

📅 **Calendar 日历** - 强大的时间管理工具，8种视图模式支持

## 核心功能

### 📋 多视图模式
支持8种不同的日历视图，满足不同场景的时间管理需求：

- **月视图**：传统月历，清晰展示整月事件
- **周视图**：详细展示一周安排
- **工作周视图**：仅显示工作日（周一至周五）
- **日视图**：聚焦单日，查看详细时间安排
- **时间轴日视图**：水平时间轴展示单日事件
- **时间轴周视图**：水平时间轴展示一周事件
- **时间轴工作周视图**：水平时间轴展示工作周
- **日程视图**：列表式展示所有事件

**智能特性**：
- 记住上次使用的视图模式，下次打开自动恢复
- 月视图显示下方议程（200px高度）
- 时间槽视图显示6:00-23:00，每30分钟一格

### 🎯 事件管理
- **创建事件**：支持标题、描述、图标、颜色自定义
- **编辑事件**：点击事件即可编辑
- **完成事件**：标记事件为已完成，独立存储
- **删除事件**：支持滑动删除
- **跨天事件**：自动处理跨日、跨周事件

### 🔔 智能提醒
支持8种提醒时间设置：
- 不提醒
- 提前5分钟/15分钟/30分钟
- 提前1小时/2小时
- 提前1天/2天

提醒系统基于Android本地通知，到期自动提醒。

### 📊 事件统计
主页卡片显示三大关键指标：
- **活动数量**：所有未完成事件总数
- **7天活动**：未来7天内的事件数量（橙色提示）
- **过期活动**：已过开始时间的事件数量（红色警告）

### 🔗 Todo任务集成
自动同步Todo插件中的任务事件：
- 仅显示**同时设置了开始日期和截止日期**的任务
- 根据任务优先级显示不同颜色：
  - 🔴 高优先级：红色
  - 🟠 中优先级：橙色
  - 🔵 低优先级：蓝色
- Todo任务事件为只读状态，无法在日历中直接编辑

## 数据结构

### 存储位置
```
calendar/
├── calendar_events.json     # 事件数据
└── calendar_last_view.json  # 视图状态
```

### 事件格式
```json
{
  "id": "1705300800000",
  "title": "项目会议",
  "description": "讨论Q1计划",
  "startTime": "2025-01-15T09:00:00.000Z",
  "endTime": "2025-01-15T10:00:00.000Z",
  "icon": 58050,
  "color": 4280391411,
  "source": "default",
  "reminderMinutes": 15
}
```

**字段说明**：
- `source`: 事件来源
  - `default`: 普通日历事件，可编辑删除
  - `todo`: 来自Todo插件的任务事件，只读
- `icon`: Material Icons的codePoint值
- `color`: 颜色值（整数表示）

## 操作指南

### 基本操作

#### 1. 创建事件
1. 点击右下角「+」按钮
2. 选择圆形图标和颜色
3. 输入事件标题（必填）
4. 输入事件描述（可选）
5. 选择开始日期和时间
6. 选择结束日期和时间
7. 设置提醒时间
8. 点击保存

#### 2. 查看事件
- **月视图**：点击日期查看当天事件
- **议程区**：月视图下方显示选中日期的事件列表
- **事件详情**：点击事件弹出详情卡片

#### 3. 编辑事件
1. 点击要编辑的事件
2. 在详情卡片中点击「编辑」按钮
3. 修改相关信息
4. 点击保存

#### 4. 完成事件
- **方式一**：在事件列表页右滑事件（绿色背景）
- **方式二**：在详情卡片中点击「完成」按钮

#### 5. 删除事件
- **方式一**：在事件列表页左滑事件（红色背景）
- **方式二**：在详情卡片中点击「删除」按钮

### 视图管理

#### 切换视图
1. 点击顶部工具栏的视图切换按钮
2. 选择需要的视图模式
3. 系统自动记住选择，下次打开默认使用该视图

#### 跳转日期
- 点击「今天」按钮快速跳转到当前日期
- 在日历上点击任意日期进行选择

#### 查看历史
- 左右滑动切换月份/周/日
- 使用顶部导航栏快速跳转到指定月份

## 高级功能

### 事件列表管理
- **全部事件列表**：查看所有未完成事件
- **已完成事件**：独立查看已完成的事件记录
- 支持滑动操作：右滑完成，左滑删除

### 时间格式
事件时间显示智能格式化：
- **同一天**：`01-15 09:00 - 10:00`
- **跨天**：`01-15 09:00 - 01-16 10:00`

### 跨插件集成
当前已集成插件：
- **Todo插件**：同步带日期的任务
- **未来计划**：集成更多插件事件数据

## 常见问题

**Q1: 为什么有些事件无法编辑？**
A: 来自Todo插件的任务事件（`source='todo'`）是只读的。如需编辑，请在Todo插件中修改任务。

**Q2: 如何修改事件的默认时长？**
A: 当前默认时长为1小时。如需修改，在创建事件时手动设置结束时间。

**Q3: 为什么看不到Todo任务？**
A: 仅显示**同时设置了开始日期和截止日期**的任务。请检查Todo任务是否正确设置了日期范围。

**Q4: 如何添加新的提醒时间？**
A: 目前支持8种预设提醒时间。如需自定义，可在代码中修改 `event_edit_page.dart` 的提醒选项。

**Q5: 视图模式如何持久化？**
A: 插件会自动保存最后使用的视图模式到 `calendar_last_view.json`，下次打开时自动恢复。

**Q6: 如何导出日历事件？**
A: 当前版本暂未实现导出功能。如需备份，可手动复制 `calendar_events.json` 文件。

**Q7: 月视图的议程区可以隐藏吗？**
A: 目前议程区固定显示200px高度，暂不支持自定义隐藏。

## 小贴士

💡 **快速创建**：在日历上双击即可快速创建事件

💡 **颜色管理**：为不同类型事件设置专属颜色，快速识别

💡 **及时完成**：完成后的事件会移动到「已完成事件」列表，不会干扰日常查看

💡 **视图记忆**：插件会记住您的视图偏好，下次打开自动使用相同视图

💡 **Todo集成**：充分利用Todo插件的日期功能，在日历中统一查看所有时间相关事项

💡 **定期清理**：建议定期清理已完成的事件，保持日历简洁

## 技术实现

- **UI框架**：Flutter + Syncfusion Calendar组件
- **数据存储**：JSON文件存储
- **通知系统**：flutter_local_notifications
- **视图支持**：8种日历视图模式
- **跨插件通信**：通过PluginManager和事件系统

---

*让每一天都有迹可循，让每一刻都井然有序*