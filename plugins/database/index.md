# Database - 自定义数据库插件

<PluginSwiper plugin-name="database" />

🗄️ **Database 自定义数据库** - 灵活数据管理，打造专属数据库

## 核心功能

### 📋 自定义字段系统
- **11种字段类型**：文本、长文本、整数、复选框、下拉选择、日期、时间、日期时间、图片、网址、评分、密码
- **灵活字段管理**：支持字段拖拽排序、动态添加/编辑字段
- **字段属性设置**：设置字段名称、类型、是否必填
- **可视化编辑**：直观的字段编辑界面

### 📊 数据管理
- **记录 CRUD**：创建、读取、更新、删除数据库记录
- **多视图模式**：列表视图和网格视图两种展示方式
- **数据库复制**：支持一键复制现有数据库
- **数据持久化**：基于 JSON 的本地存储机制

### 🎨 界面特性
- **网格布局**：2列网格展示数据库列表
- **封面图片**：支持自定义数据库封面图片
- **滑动操作**：支持滑动删除记录
- **长按菜单**：长按显示操作菜单（编辑/复制/删除）
- **下拉刷新**：支持数据刷新

### 💾 存储结构
- **数据库元数据**：`databases/databases` - 存储所有数据库的定义信息
- **记录数据**：`records_{databaseId}` - 存储各数据库的具体记录

## 支持的字段类型

| 类型 | 描述 | 图标 | 输入组件 |
|------|------|------|---------|
| `Text` | 单行文本 | 📝 | 文本输入框 |
| `Long Text` | 多行文本 | 📄 | 多行文本输入框 |
| `Integer` | 整数 | 🔢 | 数字输入框 |
| `Checkbox` | 复选框 | ☑️ | 复选框 |
| `Dropdown` | 下拉选择 | 🔽 | 下拉选择器 |
| `Date` | 日期 | 📅 | 日期选择器 |
| `Time` | 时间 | ⏰ | 时间选择器 |
| `Date/Time` | 日期时间 | 📆 | 日期时间选择器 |
| `Image` | 图片 | 🖼️ | 图片选择器 |
| `URL` | 网址 | 🔗 | 文本输入框 |
| `Rating` | 评分 | ⭐ | 评分组件 |
| `Password` | 密码 | 🔒 | 密码输入框 |

## 使用场景

### 个人数据管理
- **藏书管理**：管理个人藏书信息、阅读进度
- **影单管理**：记录观看的电影和评价
- **歌单管理**：管理音乐收藏、歌手信息
- **资产管理**：记录个人资产、投资信息

### 工作应用
- **客户管理**：自定义客户信息字段
- **产品管理**：产品信息数据库、库存管理
- **项目管理**：项目信息追踪、任务管理
- **员工管理**：员工信息、考勤记录

### 学习研究
- **文献管理**：学术文献数据库、论文管理
- **调研数据**：市场调研数据管理
- **实验记录**：实验数据和结果记录
- **学习笔记**：结构化学习笔记

## 操作指南

### 创建数据库
1. 点击主页「Database」插件卡片
2. 点击右下角「+」按钮创建新数据库
3. 输入数据库名称、描述和封面图片
4. 切换到「字段」Tab添加字段
5. 选择字段类型并设置属性
6. 保存数据库结构

### 管理字段
1. 进入数据库编辑界面
2. 在「字段」Tab中查看字段列表
3. 拖拽字段进行排序
4. 点击字段进行编辑或删除
5. 点击「+」添加新字段

### 添加记录
1. 在数据库详情页面点击「+」
2. 根据字段类型填写数据
3. 系统自动验证必填字段
4. 点击保存按钮提交

### 管理数据库
- **查看列表**：网格视图展示所有数据库
- **编辑数据库**：长按选择「编辑」
- **复制数据库**：长按选择「复制」（使用UUID生成新ID）
- **删除数据库**：长按选择「删除」

## 数据模型

### DatabaseModel (数据库)
```json
{
  "id": "1234567890",
  "name": "项目管理",
  "description": "用于跟踪项目进度",
  "coverImage": "images/project_cover.jpg",
  "fields": [
    {"id": "f1", "name": "项目名称", "type": "Text", "isRequired": true},
    {"id": "f2", "name": "截止日期", "type": "Date", "isRequired": false},
    {"id": "f3", "name": "优先级", "type": "Rating", "isRequired": false}
  ],
  "createdAt": "2025-01-15T10:30:00.000Z",
  "updatedAt": "2025-01-16T14:20:00.000Z"
}
```

### Record (记录)
```json
{
  "id": "1234567890123",
  "tableId": "1234567890",
  "fields": {
    "项目名称": "Memento 应用开发",
    "截止日期": "2025-03-01T00:00:00.000Z",
    "优先级": 5,
    "负责人": "张三",
    "完成状态": true
  },
  "createdAt": "2025-01-15T08:30:00.000Z",
  "updatedAt": "2025-01-16T10:15:00.000Z"
}
```

## 界面结构

### 数据库列表页面
- **网格布局**：2列网格展示
- **卡片信息**：封面图片、数据库名称
- **操作菜单**：长按显示编辑/复制/删除选项
- **新建按钮**：右下角FloatingActionButton

### 数据库详情页面
- **视图切换**：列表视图/网格视图切换按钮
- **记录展示**：根据视图模式展示记录列表
- **滑动删除**：左滑删除记录
- **新建记录**：右下角FloatingActionButton

### 数据库编辑页面
- **双Tab设计**：
  - 基本信息Tab：名称、描述、封面图片
  - 字段Tab：字段列表、拖拽排序
- **图片裁剪**：支持1:1比例裁剪
- **字段类型选择**：弹窗选择字段类型

### 记录编辑页面
- **动态表单**：根据数据库字段自动生成
- **类型适配**：不同字段类型使用不同输入组件
- **表单验证**：自动验证必填字段
- **默认值支持**：支持设置字段默认值

## 插件配置

### 存储配置
- **元数据存储**：`storage/databases/databases.json`
- **记录存储**：`storage/records_{databaseId}.json`

### 依赖包
- `uuid`: UUID生成（用于数据库复制）
- `image_picker`: 图片选择器
- `Memento/widgets/image_picker_dialog.dart`: 自定义图片选择对话框
- `Memento/utils/image_utils.dart`: 图片工具类

## 国际化支持

### 支持语言
- 简体中文 (zh)
- 英语 (en)

### 关键字符串
- 插件名称：数据库
- 数据库操作：创建、编辑、删除、复制
- 字段操作：添加、编辑、排序、类型选择
- 记录操作：新建、编辑、删除
- 通用操作：保存、取消、确认、取消

## 常见问题

**Q: 如何添加新的字段类型？**
A: 需要在FieldController中扩展fieldTypes Map并添加对应的buildFieldWidget实现。

**Q: 数据库ID是如何生成的？**
A: 创建数据库时使用时间戳作为ID，复制数据库时使用UUID生成新ID。

**Q: 如何实现数据导入导出？**
A: 当前版本未实现，建议在DatabaseController中添加exportDatabase和importDatabase方法。

**Q: 字段默认值如何设置？**
A: 可以在FieldModel的description字段中存储默认值，在RecordEditWidget中读取使用。

**Q: 支持记录搜索吗？**
A: 当前版本未实现，建议在DatabaseController中添加searchRecords方法。

**Q: 如何实现字段验证？**
A: 建议在DatabaseField中添加validation字段，存储验证规则，并在FieldController中应用验证逻辑。

**Q: 数据库复制会复制记录吗？**
A: 当前仅复制数据库结构，不复制记录。如需复制记录，需同时复制records_{databaseId}数据。

## 扩展建议

### 计划功能
- **数据验证系统**：添加字段验证规则
- **数据导入导出**：支持CSV/JSON/Excel格式
- **关系字段**：支持多数据库之间的关联
- **视图与过滤**：自定义视图和过滤条件
- **公式字段**：支持计算字段
- **事件系统**：数据库和记录操作的广播事件

---

*让数据结构化，让数据更有价值*
