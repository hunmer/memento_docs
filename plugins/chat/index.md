# ğŸ’¬ Chat èŠå¤©æ’ä»¶

<PluginSwiper plugin-name="chat" />

## æ’ä»¶ç®€ä»‹

Chat èŠå¤©æ’ä»¶æ˜¯ Memento çš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ä¹‹ä¸€ï¼Œæä¾›ç±»ä¼¼å¾®ä¿¡æ–‡ä»¶åŠ©æ‰‹çš„å¤šé¢‘é“èŠå¤©ä½“éªŒï¼Œå¹¶é›†æˆ AI å¯¹è¯åŠŸèƒ½ã€‚æ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ã€æ–‡ä»¶ã€Markdown ç­‰å¤šç§æ¶ˆæ¯ç±»å‹ã€‚

**æ’ä»¶ ID**: `chat`

## ä¸»è¦åŠŸèƒ½

### å¤šé¢‘é“ç®¡ç†

- **ç‹¬ç«‹é¢‘é“**ï¼šåˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„èŠå¤©é¢‘é“
- **é¢‘é“å®šåˆ¶**ï¼šè‡ªå®šä¹‰é¢‘é“åç§°ã€å¤´åƒã€ä¸»é¢˜è‰²
- **æ¶ˆæ¯é¢„è§ˆ**ï¼šé¢‘é“åˆ—è¡¨æ˜¾ç¤ºæœ€åä¸€æ¡æ¶ˆæ¯
- **æœªè¯»è®¡æ•°**ï¼šå®æ—¶æ˜¾ç¤ºæœªè¯»æ¶ˆæ¯æ•°é‡

### ä¸°å¯Œæ¶ˆæ¯ç±»å‹

| æ¶ˆæ¯ç±»å‹ | è¯´æ˜ |
|---------|------|
| `text` | æ–‡æœ¬æ¶ˆæ¯ |
| `image` | å›¾ç‰‡æ¶ˆæ¯ |
| `video` | è§†é¢‘æ¶ˆæ¯ |
| `audio` | éŸ³é¢‘æ¶ˆæ¯ |
| `file` | æ–‡ä»¶æ¶ˆæ¯ |
| `markdown` | Markdown æ ¼å¼ |

### AI å¯¹è¯é›†æˆ

- **@è§¦å‘**ï¼šåœ¨æ¶ˆæ¯ä¸­è¾“å…¥ `@AI` æˆ– `@åŠ©æ‰‹åç§°` è§¦å‘ AI å¯¹è¯
- **ä¸Šä¸‹æ–‡ç†è§£**ï¼šè‡ªåŠ¨æ„å»ºæœ€è¿‘ 10 æ¡æ¶ˆæ¯ä½œä¸ºä¸Šä¸‹æ–‡
- **å¤šåŠ©æ‰‹æ”¯æŒ**ï¼šé€šè¿‡ OpenAI æ’ä»¶è¿æ¥å¤šç§ AI æœåŠ¡

### æ—¶é—´çº¿è§†å›¾

- **è·¨é¢‘é“èšåˆ**ï¼šæ±‡æ€»æ‰€æœ‰é¢‘é“çš„æ¶ˆæ¯
- **æŒ‰æ—¶é—´æ’åº**ï¼šæ¶ˆæ¯æŒ‰æ—¶é—´å€’åºå±•ç¤º
- **åˆ†é¡µåŠ è½½**ï¼šæ¯é¡µ 20 æ¡ï¼Œæ”¯æŒæ— é™æ»šåŠ¨
- **é«˜çº§ç­›é€‰**ï¼šæŒ‰é¢‘é“ã€ç”¨æˆ·ã€æ¶ˆæ¯ç±»å‹ç­›é€‰
- **å…¨æ–‡æœç´¢**ï¼šå¿«é€ŸæŸ¥æ‰¾å†å²æ¶ˆæ¯

### æ¶ˆæ¯ç®¡ç†

- **æ”¶è—æ¶ˆæ¯**ï¼šæ ‡è®°é‡è¦æ¶ˆæ¯ä»¥ä¾¿åç»­æŸ¥çœ‹
- **å›ºå®šæ¶ˆæ¯**ï¼šç½®é¡¶é‡è¦æ¶ˆæ¯
- **å›å¤åŠŸèƒ½**ï¼šå¼•ç”¨å¹¶å›å¤ç‰¹å®šæ¶ˆæ¯
- **åˆ é™¤æ¶ˆæ¯**ï¼šç®¡ç†ä¸éœ€è¦çš„èŠå¤©å†…å®¹

## å¿«é€Ÿå¼€å§‹

### åˆ›å»ºé¢‘é“

1. ç‚¹å‡»ã€Œæ–°å»ºé¢‘é“ã€æŒ‰é’®
2. è¾“å…¥é¢‘é“åç§°
3. å¯é€‰è®¾ç½®å¤´åƒå’Œä¸»é¢˜è‰²
4. ç‚¹å‡»ã€Œåˆ›å»ºã€å®Œæˆ

### å‘é€æ¶ˆæ¯

1. é€‰æ‹©ç›®æ ‡é¢‘é“
2. åœ¨è¾“å…¥æ¡†è¾“å…¥æ¶ˆæ¯å†…å®¹
3. ç‚¹å‡»å‘é€æŒ‰é’®æˆ–æŒ‰ Enter é”®
4. æ”¯æŒé€šè¿‡é™„ä»¶æŒ‰é’®å‘é€å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ã€æ–‡ä»¶

### ä½¿ç”¨ AI åŠ©æ‰‹

1. åœ¨æ¶ˆæ¯ä¸­è¾“å…¥ `@AI` æˆ–ç‰¹å®šåŠ©æ‰‹åç§°
2. è¾“å…¥æ‚¨çš„é—®é¢˜
3. ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ AI å¹¶å›å¤
4. AI å›å¤ä¼šä½œä¸ºæ–°æ¶ˆæ¯å‡ºç°åœ¨å¯¹è¯ä¸­

## æœåŠ¡æ¶æ„

æ’ä»¶é‡‡ç”¨ **Service å±‚æ¨¡å¼**ï¼Œä¸šåŠ¡é€»è¾‘ä¸ UI åˆ†ç¦»ï¼š

| æœåŠ¡ | èŒè´£ |
|------|------|
| `ChannelService` | é¢‘é“å¢åˆ æ”¹æŸ¥ã€æ¶ˆæ¯åŠ è½½ |
| `MessageService` | æ¶ˆæ¯å‘é€ã€ç¼–è¾‘ã€åˆ é™¤ã€æ”¶è— |
| `UserService` | ç”¨æˆ·ç®¡ç†ï¼ˆè‡ªå·± + AI ç”¨æˆ·ï¼‰ |
| `SettingsService` | æ’ä»¶é…ç½®ï¼ˆä¸»é¢˜ã€æ’åºç­‰ï¼‰ |
| `UIService` | UI ç»„ä»¶æ„å»ºï¼ˆå¡ç‰‡è§†å›¾ã€è®¾ç½®ç•Œé¢ï¼‰ |
| `FileService` | æ–‡ä»¶ä¸Šä¼ ã€é¢„è§ˆ |

## æ ¸å¿ƒ API

### é¢‘é“æ“ä½œ

```dart
// è·å–æ‰€æœ‰é¢‘é“
Future<List<Channel>> getChannels();

// åˆ›å»ºé¢‘é“
Future<Channel> createChannel(String name, {String? avatar, Color? color});

// åˆ é™¤é¢‘é“
Future<void> deleteChannel(String channelId);

// åŠ è½½é¢‘é“æ¶ˆæ¯
Future<List<Message>> getChannelMessages(String channelId, {int? limit});
```

### æ¶ˆæ¯æ“ä½œ

```dart
// å‘é€æ–‡æœ¬æ¶ˆæ¯
Future<Message> sendTextMessage(String channelId, String content, {String? replyToId});

// å‘é€æ–‡ä»¶æ¶ˆæ¯
Future<Message> sendFileMessage(String channelId, String filePath, FileType fileType);

// åˆ é™¤æ¶ˆæ¯
Future<void> deleteMessage(String channelId, String messageId);

// æ”¶è—/å–æ¶ˆæ”¶è—
Future<void> toggleFavorite(String channelId, String messageId);

// å›ºå®š/å–æ¶ˆå›ºå®š
Future<void> togglePinned(String channelId, String messageId);
```

### ç”¨æˆ·æ“ä½œ

```dart
// è·å–å½“å‰ç”¨æˆ·
User getCurrentUser();

// è·å–AIç”¨æˆ·
User getAIUser();

// æ›´æ–°ç”¨æˆ·ä¿¡æ¯
Future<void> updateUser(User user);
```

## æ•°æ®æ¨¡å‹

### Channel (é¢‘é“)

```dart
class Channel {
  String id;              // UUID
  String name;            // é¢‘é“åç§°
  String? avatar;         // å¤´åƒè·¯å¾„
  Color? color;           // ä¸»é¢˜è‰²
  DateTime createdAt;     // åˆ›å»ºæ—¶é—´
  DateTime updatedAt;     // æ›´æ–°æ—¶é—´
  Message? lastMessage;   // æœ€åä¸€æ¡æ¶ˆæ¯
  int unreadCount;        // æœªè¯»æ•°é‡
}
```

**å­˜å‚¨è·¯å¾„**: `chat/channels/<channelId>.json`

### Message (æ¶ˆæ¯)

```dart
class Message {
  String id;              // UUID
  String channelId;       // æ‰€å±é¢‘é“
  String content;         // æ¶ˆæ¯å†…å®¹
  String userId;          // å‘é€è€…ID
  MessageType type;       // æ¶ˆæ¯ç±»å‹
  DateTime timestamp;     // å‘é€æ—¶é—´
  bool isFavorite;        // æ˜¯å¦æ”¶è—
  bool isPinned;          // æ˜¯å¦å›ºå®š
  String? replyToId;      // å›å¤çš„æ¶ˆæ¯ID
  Map<String, dynamic>? metadata; // é¢å¤–å…ƒæ•°æ®
}
```

**å­˜å‚¨è·¯å¾„**: `chat/messages/<channelId>/<messageId>.json`

### User (ç”¨æˆ·)

```dart
class User {
  String id;              // UUID
  String name;            // ç”¨æˆ·å
  String? avatar;         // å¤´åƒè·¯å¾„
  bool isAI;              // æ˜¯å¦ä¸ºAI
}
```

**å­˜å‚¨è·¯å¾„**: `chat/users/<userId>.json`

## é…ç½®è¯´æ˜

**é…ç½®è·¯å¾„**: `configs/chat/settings.json`

```json
{
  "showTimestamp": true,
  "messageGrouping": "byDate",
  "defaultAvatar": "assets/icon/default_user.png"
}
```

## å¤–éƒ¨ä¾èµ–

- `image_picker`: å›¾ç‰‡/è§†é¢‘é€‰æ‹©
- `file_picker`: æ–‡ä»¶é€‰æ‹©
- `audioplayers`: éŸ³é¢‘æ’­æ”¾
- `record`: éŸ³é¢‘å½•åˆ¶
- `flutter_quill`: Markdown æ¸²æŸ“
- `photo_view`: å›¾ç‰‡æŸ¥çœ‹å™¨
- `media_kit`: è§†é¢‘æ’­æ”¾

## æ’ä»¶ä¾èµ–

- **OpenAI Plugin**: AI å¯¹è¯åŠŸèƒ½
- **Core Event System**: æ¶ˆæ¯äº‹ä»¶å¹¿æ’­

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ·»åŠ æ–°çš„æ¶ˆæ¯ç±»å‹ï¼Ÿ

1. åœ¨ `models/message.dart` çš„ `MessageType` æšä¸¾ä¸­æ·»åŠ ç±»å‹
2. åœ¨ `MessageContent` ç»„ä»¶ä¸­æ·»åŠ æ¸²æŸ“é€»è¾‘
3. åœ¨ `MessageInputActions` ä¸­æ·»åŠ è§¦å‘æŒ‰é’®

### Q: å¦‚ä½•è‡ªå®šä¹‰æ¶ˆæ¯æ°”æ³¡æ ·å¼ï¼Ÿ

ä¿®æ”¹ `screens/chat_screen/widgets/message_bubble.dart` ä¸­çš„æ ·å¼é…ç½®ã€‚

### Q: æ¶ˆæ¯æ•°é‡è¿‡å¤šå¯¼è‡´å¡é¡¿æ€ä¹ˆåŠï¼Ÿ

ä¼˜åŒ–æ–¹å‘ï¼š
1. ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆ`ListView.builder` å·²éƒ¨åˆ†å®ç°ï¼‰
2. é™åˆ¶å†…å­˜ä¸­çš„æ¶ˆæ¯æ•°é‡
3. æ·»åŠ æ¶ˆæ¯å½’æ¡£åŠŸèƒ½ï¼ˆ30å¤©åè‡ªåŠ¨å½’æ¡£ï¼‰

### Q: å¦‚ä½•åŒæ­¥èŠå¤©è®°å½•åˆ°å…¶ä»–è®¾å¤‡ï¼Ÿ

åœ¨è®¾ç½®ä¸­å¼€å¯ WebDAV åŒæ­¥åŠŸèƒ½ï¼ŒèŠå¤©è®°å½•ä¼šè‡ªåŠ¨åŒæ­¥åˆ°äº‘ç«¯ã€‚

## æ•°æ®å®‰å…¨

- **æœ¬åœ°å­˜å‚¨**ï¼šèŠå¤©è®°å½•ä¼˜å…ˆæœ¬åœ°ä¿å­˜
- **äº‘ç«¯åŒæ­¥**ï¼šå¯é€‰çš„ WebDAV åŒæ­¥å¤‡ä»½
- **éšç§ä¿æŠ¤**ï¼šæ•°æ®æŒæ§åœ¨ç”¨æˆ·æ‰‹ä¸­

---

å¼€å§‹ä½¿ç”¨ Chat æ’ä»¶ï¼Œäº«å—æ™ºèƒ½æ²Ÿé€šçš„ä¹è¶£ï¼
